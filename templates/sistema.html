<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Estacionamento Rotativo - Recanto das Flores I</title>
  <link rel="icon" type="image/png" href="/static/imagens/icon.png">
  <link rel="stylesheet" href="/static/style.css">
  <style>
    /* Estilos espec√≠ficos para o sistema */
    .sistema-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      font-family: 'Montserrat', sans-serif;
    }

    .header-sistema {
      text-align: center;
      margin-bottom: 30px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    .header-sistema h1 {
      margin: 0;
      font-size: 2.5em;
      font-weight: 700;
    }

    .header-sistema h2 {
      margin: 10px 0 0 0;
      font-size: 1.2em;
      opacity: 0.9;
    }

    .menu-funcoes {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }

    .btn-funcao {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 20px;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .btn-funcao:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.2);
    }

    .secao {
      background: white;
      border-radius: 15px;
      padding: 30px;
      margin-bottom: 20px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
      border: 1px solid #e0e0e0;
    }

    .secao h2 {
      color: #333;
      margin-bottom: 25px;
      font-size: 1.8em;
      border-bottom: 3px solid #667eea;
      padding-bottom: 10px;
    }

    .form-sistema {
      display: grid;
      gap: 20px;
    }

    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-group label {
      margin-bottom: 8px;
      font-weight: 600;
      color: #555;
    }

    .form-group input, .form-group select {
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.3s ease;
    }

    .form-group input:focus, .form-group select:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .btn-submit {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      justify-self: start;
    }

    .btn-submit:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    .btn-info {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-info:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    .btn-danger {
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-danger:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    .btn-secondary {
      background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-secondary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    .resultado {
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
      font-weight: 600;
    }

    .resultado.sucesso {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .resultado.erro {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .resultado.info {
      background-color: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }

    .vagas-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .vaga-card {
      background: white;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      padding: 15px;
      text-align: center;
      transition: all 0.3s ease;
      position: relative;
    }

    .vaga-card.livre {
      border-color: #28a745;
      background-color: #f8fff9;
    }

    .vaga-card.ocupada {
      border-color: #dc3545;
      background-color: #fff8f8;
    }

    .vaga-card.tempo-excedido {
      border-color: #ff6b35;
      background-color: #fff5f0;
    }

    .vaga-card h3 {
      margin: 0 0 10px 0;
      font-size: 1.2em;
    }

    .status-livre {
      color: #28a745;
      font-weight: 600;
    }

    .status-ocupada {
      color: #dc3545;
      font-weight: 600;
    }

    /* Estilos para o timer de contagem regressiva */
    .timer-container {
      margin-top: 10px;
      padding: 10px;
      background-color: #f8f9fa;
      border-radius: 8px;
      border: 1px solid #dee2e6;
    }

    .timer-display {
      font-family: 'Courier New', monospace;
      font-size: 1.1em;
      font-weight: bold;
      text-align: center;
      color: #495057;
    }

    .timer-normal {
      color: #28a745;
    }

    .timer-warning {
      color: #ffc107;
      animation: pulse-warning 2s infinite;
    }

    .timer-critical {
      color: #dc3545;
      animation: pulse-critical 1s infinite;
    }

    .timer-expired {
      color: #dc3545;
      background-color: #f8d7da;
      border-color: #f5c6cb;
      animation: flash-expired 0.5s infinite;
    }

    @keyframes pulse-warning {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    @keyframes pulse-critical {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }

    @keyframes flash-expired {
      0%, 100% { background-color: #f8d7da; }
      50% { background-color: #f1aeb5; }
    }

    .timer-label {
      font-size: 0.9em;
      color: #6c757d;
      margin-bottom: 5px;
    }

    .tempo-restante {
      font-size: 0.85em;
      color: #6c757d;
      margin-top: 5px;
    }

    .veiculo-info {
      font-size: 0.9em;
      color: #495057;
      margin-top: 5px;
    }

    .veiculo-info strong {
      color: #212529;
    }

    .loading {
      text-align: center;
      padding: 20px;
      color: #666;
    }

    .hidden {
      display: none !important;
    }

    @media (max-width: 768px) {
      .menu-funcoes {
        grid-template-columns: 1fr;
      }
      
      .form-row {
        grid-template-columns: 1fr;
      }
      
      .header-sistema h1 {
        font-size: 2em;
      }
    }
  </style>
</head>
<body>
  <div class="sistema-container">
    <!-- Header do Sistema -->
    <div class="header-sistema">
      <h1>üå∏ Recanto das Flores I</h1>
      <h2>Sistema de Estacionamento Rotativo</h2>
    </div>

    <!-- Menu Principal -->
    <div class="menu-funcoes">
      <button class="btn-funcao" onclick="abrirSecao('supervisor')">
        üîê √Årea do Supervisor
      </button>
      <button class="btn-funcao" onclick="abrirSecao('cadastro')">
        üìã Cadastrar Ve√≠culo
      </button>
      <button class="btn-funcao" onclick="abrirSecao('estacionar')">
        üöó Estacionar Ve√≠culo
      </button>
      <button class="btn-funcao" onclick="abrirSecao('saida')">
        üßπ Registrar Sa√≠da
      </button>
      <button class="btn-funcao" onclick="abrirSecao('vagas')">
        üìä Ver Status das Vagas
      </button>
      <button class="btn-funcao" onclick="abrirSecao('tempo')">
        ‚è± Verificar Tempo Excedido
      </button>
      <button class="btn-funcao" onclick="abrirSecao('remover')">
        ‚ùå Remover por CPF
      </button>
    </div>

    <!-- Se√ß√£o: √Årea do Supervisor -->
    <div id="supervisor" class="secao hidden">
      <h2>üîê √Årea do Supervisor</h2>
      <form id="formSupervisor" class="form-sistema">
        <div class="form-group">
          <label for="senhaSupervisor">Senha do Supervisor:</label>
          <input type="password" id="senhaSupervisor" name="senha" placeholder="Digite a senha" required>
        </div>
        <button type="submit" class="btn-submit">Entrar como Supervisor</button>
      </form>
      <div id="resultadoSupervisor" class="resultado hidden"></div>
      
      <!-- Bot√£o Voltar -->
      <div style="margin-top: 20px; text-align: center;">
        <button onclick="voltarPaginaAnterior()" class="btn-voltar">‚Üê Voltar</button>
      </div>
    </div>

    <!-- Se√ß√£o: Cadastro de Ve√≠culo -->
    <div id="cadastro" class="secao hidden">
      <h2>üìã Cadastro de Ve√≠culo</h2>
      <form id="formCadastro" class="form-sistema">
        <div class="form-row">
          <div class="form-group">
            <label for="cpfCadastro">CPF:</label>
            <input type="text" id="cpfCadastro" name="cpf" placeholder="000.000.000-00" required>
          </div>
          <div class="form-group">
            <label for="placaCadastro">Placa:</label>
            <input type="text" id="placaCadastro" name="placa" placeholder="ABC1234" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="modeloCadastro">Modelo:</label>
            <input type="text" id="modeloCadastro" name="modelo" placeholder="Ex: Gol, Civic, etc.">
          </div>
          <div class="form-group">
            <label for="nomeCadastro">Nome do Propriet√°rio:</label>
            <input type="text" id="nomeCadastro" name="nome" placeholder="Nome completo" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="blocoCadastro">Bloco:</label>
            <input type="text" id="blocoCadastro" name="bloco" placeholder="Ex: A, B, C">
          </div>
          <div class="form-group">
            <label for="apartamentoCadastro">Apartamento:</label>
            <input type="text" id="apartamentoCadastro" name="apartamento" placeholder="Ex: 101, 202">
          </div>
        </div>
        <div class="form-group">
          <label for="matriculaCadastro">Matr√≠cula do Funcion√°rio:</label>
          <input type="text" id="matriculaCadastro" name="matricula" placeholder="Digite sua matr√≠cula" required>
        </div>
        <button type="submit" class="btn-submit">Cadastrar Ve√≠culo</button>
      </form>
      <div id="resultadoCadastro" class="resultado hidden"></div>
      
      <!-- Bot√£o Voltar -->
      <div style="margin-top: 20px; text-align: center;">
        <button onclick="voltarPaginaAnterior()" class="btn-voltar">‚Üê Voltar</button>
      </div>
    </div>

    <!-- Se√ß√£o: Estacionar Ve√≠culo -->
    <div id="estacionar" class="secao hidden">
      <h2>üöó Estacionar Ve√≠culo</h2>
      <form id="formEstacionar" class="form-sistema">
        <div class="form-row">
          <div class="form-group">
            <label for="placaEstacionar">Placa do Ve√≠culo:</label>
            <input type="text" id="placaEstacionar" name="placa" placeholder="ABC1234" required>
          </div>
          <div class="form-group">
            <label for="matriculaEstacionar">Matr√≠cula do Funcion√°rio:</label>
            <input type="text" id="matriculaEstacionar" name="matricula" placeholder="Digite sua matr√≠cula" required>
          </div>
        </div>
        <button type="submit" class="btn-submit">Estacionar Ve√≠culo</button>
      </form>
      <div id="resultadoEstacionar" class="resultado hidden"></div>
    </div>

    <!-- Se√ß√£o: Registrar Sa√≠da -->
    <div id="saida" class="secao hidden">
      <h2>üßπ Registrar Sa√≠da</h2>
      <form id="formSaida" class="form-sistema">
        <div class="form-row">
          <div class="form-group">
            <label for="placaSaida">Placa do Ve√≠culo:</label>
            <input type="text" id="placaSaida" name="placa" placeholder="ABC1234" required>
          </div>
          <div class="form-group">
            <label for="matriculaSaida">Matr√≠cula do Funcion√°rio:</label>
            <input type="text" id="matriculaSaida" name="matricula" placeholder="Digite sua matr√≠cula" required>
          </div>
        </div>
        <button type="submit" class="btn-submit">Registrar Sa√≠da</button>
      </form>
      <div id="resultadoSaida" class="resultado hidden"></div>
      
      <!-- Bot√£o Voltar -->
      <div style="margin-top: 20px; text-align: center;">
        <button onclick="voltarPaginaAnterior()" class="btn-voltar">‚Üê Voltar</button>
      </div>
    </div>

    <!-- Se√ß√£o: Ver Status das Vagas -->
    <div id="vagas" class="secao hidden">
      <h2>üìä Status das Vagas</h2>
      <button class="btn-info" onclick="carregarVagas()">üîÑ Atualizar Status das Vagas</button>
      <div id="loadingVagas" class="loading hidden">Carregando vagas...</div>
      <div id="resultadoVagas" class="resultado hidden"></div>
      <div id="vagasGrid" class="vagas-grid"></div>
    </div>

    <!-- Se√ß√£o: Verificar Tempo Excedido -->
    <div id="tempo" class="secao hidden">
      <h2>‚è± Verificar Tempo Excedido</h2>
      <button class="btn-info" onclick="verificarTempoExcedido()">üîç Verificar Ve√≠culos com Tempo Excedido</button>
      <div id="loadingTempo" class="loading hidden">Verificando...</div>
      <div id="resultadoTempo" class="resultado hidden"></div>
    </div>

    <!-- Se√ß√£o: Remover por CPF -->
    <div id="remover" class="secao hidden">
      <h2>‚ùå Remover Ve√≠culo por CPF</h2>
      <form id="formRemover" class="form-sistema">
        <div class="form-row">
          <div class="form-group">
            <label for="cpfRemover">CPF do Propriet√°rio:</label>
            <input type="text" id="cpfRemover" name="cpf" placeholder="000.000.000-00" required>
          </div>
          <div class="form-group">
            <label for="matriculaRemover">Matr√≠cula do Funcion√°rio:</label>
            <input type="text" id="matriculaRemover" name="matricula" placeholder="Digite sua matr√≠cula" required>
          </div>
        </div>
        <button type="submit" class="btn-danger">Remover Ve√≠culo</button>
      </form>
      <div id="resultadoRemover" class="resultado hidden"></div>
      
      <!-- Bot√£o Voltar -->
      <div style="margin-top: 20px; text-align: center;">
        <button onclick="voltarPaginaAnterior()" class="btn-voltar">‚Üê Voltar</button>
      </div>
    </div>
  </div>

  <script>
    // Fun√ß√£o para abrir se√ß√µes
    function abrirSecao(id) {
      try {
        console.log('Abrindo se√ß√£o:', id);
        
        // Parar todos os timers quando mudar de se√ß√£o
        if (id !== 'vagas') {
          pararTodosTimers();
        }
        
        // Esconde todas as se√ß√µes
        document.querySelectorAll('.secao').forEach(sec => {
          sec.classList.add('hidden');
        });
        
        // Mostra a se√ß√£o selecionada
        const secao = document.getElementById(id);
        if (secao) {
          secao.classList.remove('hidden');
          console.log('Se√ß√£o', id, 'aberta com sucesso');
          
          // Se abrir a se√ß√£o de vagas, carregar automaticamente
          if (id === 'vagas') {
            carregarVagas();
          }
        } else {
          console.error('Se√ß√£o', id, 'n√£o encontrada');
        }
        
        // Limpa resultados anteriores
        document.querySelectorAll('.resultado').forEach(res => {
          res.classList.add('hidden');
        });
      } catch (error) {
        console.error('Erro ao abrir se√ß√£o:', error);
      }
    }

    // Fun√ß√£o para mostrar resultado
    function mostrarResultado(elementId, mensagem, tipo) {
      const elemento = document.getElementById(elementId);
      elemento.textContent = mensagem;
      elemento.className = `resultado ${tipo}`;
      elemento.classList.remove('hidden');
    }

    // Fun√ß√£o para limpar formul√°rio
    function limparFormulario(formId) {
      const form = document.getElementById(formId);
      if (form) {
        form.reset();
      }
    }

    // Fun√ß√£o para fazer requisi√ß√µes AJAX
    async function fazerRequisicao(url, dados = null, metodo = 'GET') {
      try {
        const opcoes = {
          method: metodo,
          headers: {
            'Content-Type': 'application/json',
          }
        };

        if (dados) {
          opcoes.body = JSON.stringify(dados);
        }

        const resposta = await fetch(url, opcoes);
        const resultado = await resposta.json();
        
        return { sucesso: resposta.ok, dados: resultado };
      } catch (erro) {
        return { sucesso: false, dados: { mensagem: 'Erro de conex√£o: ' + erro.message } };
      }
    }

    // Formul√°rio do Supervisor
    document.getElementById('formSupervisor').addEventListener('submit', async function(e) {
      e.preventDefault();
      const senha = document.getElementById('senhaSupervisor').value;
      
      const resultado = await fazerRequisicao('/login-supervisor', { senha }, 'POST');
      
      if (resultado.sucesso) {
        mostrarResultado('resultadoSupervisor', resultado.dados.mensagem, 'sucesso');
        // Limpar formul√°rio
        limparFormulario('formSupervisor');
        // Redirecionar para √°rea do supervisor ap√≥s 2 segundos
        setTimeout(() => {
          window.location.href = '/supervisor-sistema';
        }, 2000);
      } else {
        mostrarResultado('resultadoSupervisor', resultado.dados.mensagem, 'erro');
      }
    });

    // Formul√°rio de Cadastro
    document.getElementById('formCadastro').addEventListener('submit', async function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      const dados = Object.fromEntries(formData);
      
      const resultado = await fazerRequisicao('/cadastrar-veiculo', dados, 'POST');
      
      if (resultado.sucesso) {
        mostrarResultado('resultadoCadastro', resultado.dados.mensagem, 'sucesso');
        limparFormulario('formCadastro');
      } else {
        mostrarResultado('resultadoCadastro', resultado.dados.mensagem, 'erro');
      }
    });

    // Formul√°rio de Estacionar
    document.getElementById('formEstacionar').addEventListener('submit', async function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      const dados = Object.fromEntries(formData);
      
      const resultado = await fazerRequisicao('/estacionar', dados, 'POST');
      
      if (resultado.sucesso) {
        let mensagem = resultado.dados.mensagem;
        if (resultado.dados.proprietario) {
          mensagem += `\nPropriet√°rio: ${resultado.dados.proprietario.nome}`;
          mensagem += `\nVaga: ${resultado.dados.vaga}`;
        }
        mostrarResultado('resultadoEstacionar', mensagem, 'sucesso');
        limparFormulario('formEstacionar');
      } else {
        mostrarResultado('resultadoEstacionar', resultado.dados.mensagem, 'erro');
      }
    });

    // Formul√°rio de Sa√≠da
    document.getElementById('formSaida').addEventListener('submit', async function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      const dados = Object.fromEntries(formData);
      
      const resultado = await fazerRequisicao('/liberar', dados, 'POST');
      
      if (resultado.sucesso) {
        let mensagem = resultado.dados.mensagem;
        if (resultado.dados.proprietario) {
          mensagem += `\nPropriet√°rio: ${resultado.dados.proprietario.nome}`;
        }
        mostrarResultado('resultadoSaida', mensagem, 'sucesso');
        limparFormulario('formSaida');
      } else {
        mostrarResultado('resultadoSaida', resultado.dados.mensagem, 'erro');
      }
    });

    // Formul√°rio de Remover
    document.getElementById('formRemover').addEventListener('submit', async function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      const dados = Object.fromEntries(formData);
      
      const resultado = await fazerRequisicao('/remover-veiculo-cpf', dados, 'POST');
      
      if (resultado.sucesso) {
        mostrarResultado('resultadoRemover', resultado.dados.mensagem, 'sucesso');
        limparFormulario('formRemover');
      } else {
        mostrarResultado('resultadoRemover', resultado.dados.mensagem, 'erro');
      }
    });

    // Objeto para armazenar os intervalos dos timers
    const timersVagas = {};

    // Fun√ß√£o para calcular tempo restante em milissegundos
    function calcularTempoRestante(dataEntrada, limiteHoras = 0.16667) {
      const agora = new Date().getTime();
      const entrada = new Date(dataEntrada).getTime();
      const limite = entrada + (limiteHoras * 60 * 60 * 1000); // 10 minutos em ms
      return limite - agora;
    }

    // Fun√ß√£o para formatar tempo no formato de contagem regressiva
    function formatarTempoRegressivo(milissegundos) {
      if (milissegundos <= 0) {
        return "TEMPO ESGOTADO";
      }
      
      const dias = Math.floor(milissegundos / (1000 * 60 * 60 * 24));
      const horas = Math.floor((milissegundos % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutos = Math.floor((milissegundos % (1000 * 60 * 60)) / (1000 * 60));
      const segundos = Math.floor((milissegundos % (1000 * 60)) / 1000);
      
      return `${dias}d ${String(horas).padStart(2, '0')}h ${String(minutos).padStart(2, '0')}m ${String(segundos).padStart(2, '0')}s`;
    }

    // Fun√ß√£o para determinar a classe CSS baseada no tempo restante
    function obterClasseTimer(milissegundos, totalMillis = 0.16667 * 60 * 60 * 1000) {
      if (milissegundos <= 0) return 'timer-expired';
      
      const porcentagemRestante = (milissegundos / totalMillis) * 100;
      
      if (porcentagemRestante <= 10) return 'timer-critical';
      if (porcentagemRestante <= 25) return 'timer-warning';
      return 'timer-normal';
    }

    // Fun√ß√£o para iniciar timer de uma vaga espec√≠fica
    function iniciarTimerVaga(numeroVaga, dataEntrada) {
      // Limpar timer existente se houver
      if (timersVagas[numeroVaga]) {
        clearInterval(timersVagas[numeroVaga]);
      }

      timersVagas[numeroVaga] = setInterval(() => {
        const tempoRestante = calcularTempoRestante(dataEntrada);
        const timerElement = document.getElementById(`timer-${numeroVaga}`);
        const vagaCard = document.getElementById(`vaga-${numeroVaga}`);
        
        if (timerElement && vagaCard) {
          const tempoFormatado = formatarTempoRegressivo(tempoRestante);
          const classeTimer = obterClasseTimer(tempoRestante);
          
          timerElement.innerHTML = tempoFormatado;
          timerElement.className = `timer-display ${classeTimer}`;
          
          // Atualizar classe do card da vaga se tempo esgotado
          if (tempoRestante <= 0) {
            vagaCard.classList.add('tempo-excedido');
            vagaCard.classList.remove('ocupada');
          }
        }
      }, 1000);
    }

    // Fun√ß√£o para parar todos os timers
    function pararTodosTimers() {
      Object.values(timersVagas).forEach(timer => clearInterval(timer));
      Object.keys(timersVagas).forEach(key => delete timersVagas[key]);
    }

    // Fun√ß√£o para carregar vagas (atualizada com timer)
    async function carregarVagas() {
      document.getElementById('loadingVagas').classList.remove('hidden');
      document.getElementById('resultadoVagas').classList.add('hidden');
      document.getElementById('vagasGrid').innerHTML = '';
      
      // Parar todos os timers existentes antes de carregar novos
      pararTodosTimers();
      
      const resultado = await fazerRequisicao('/vagas-completas');
      
      document.getElementById('loadingVagas').classList.add('hidden');
      
      if (resultado.sucesso) {
        const vagas = resultado.dados;
        const vagasGrid = document.getElementById('vagasGrid');
        
        vagas.forEach(vaga => {
          const vagaCard = document.createElement('div');
          let cardClass = vaga.ocupada ? 'ocupada' : 'livre';
          
          // Verificar se tempo est√° esgotado para vagas ocupadas
          if (vaga.ocupada && vaga.entrada) {
            const tempoRestante = calcularTempoRestante(vaga.entrada);
            if (tempoRestante <= 0) {
              cardClass = 'tempo-excedido';
            }
          }
          
          vagaCard.className = `vaga-card ${cardClass}`;
          vagaCard.id = `vaga-${vaga.numero}`;
          
          let status = '';
          let timerHtml = '';
          let veiculoInfo = '';
          
          if (vaga.ocupada) {
            status = `<span class="status-ocupada">üî¥ Ocupada por ${vaga.veiculo}</span>`;
            
            // Adicionar informa√ß√µes do ve√≠culo se dispon√≠veis
            if (vaga.proprietario) {
              veiculoInfo = `
                <div class="veiculo-info">
                  <strong>Propriet√°rio:</strong> ${vaga.proprietario}<br>
                  ${vaga.modelo ? `<strong>Modelo:</strong> ${vaga.modelo}<br>` : ''}
                  ${vaga.bloco ? `<strong>Bloco:</strong> ${vaga.bloco}` : ''}
                  ${vaga.apartamento ? ` - <strong>Apto:</strong> ${vaga.apartamento}` : ''}
                </div>
              `;
            }
            
            // Adicionar timer de contagem regressiva
            if (vaga.entrada) {
              const tempoRestante = calcularTempoRestante(vaga.entrada);
              const tempoFormatado = formatarTempoRegressivo(tempoRestante);
              const classeTimer = obterClasseTimer(tempoRestante);
              
              timerHtml = `
                <div class="timer-container">
                  <div class="timer-label">‚è∞ Tempo restante:</div>
                  <div id="timer-${vaga.numero}" class="timer-display ${classeTimer}">
                    ${tempoFormatado}
                  </div>
                  <div class="tempo-restante">
                    Entrada: ${new Date(vaga.entrada).toLocaleString('pt-BR')}
                  </div>
                </div>
              `;
            }
          } else {
            status = `<span class="status-livre">üü¢ Livre</span>`;
          }
          
          vagaCard.innerHTML = `
            <h3>Vaga ${vaga.numero}</h3>
            <p><strong>Tipo:</strong> ${vaga.tipo}</p>
            <p>${status}</p>
            ${veiculoInfo}
            ${timerHtml}
          `;
          
          vagasGrid.appendChild(vagaCard);
          
          // Iniciar timer se a vaga estiver ocupada
          if (vaga.ocupada && vaga.entrada) {
            iniciarTimerVaga(vaga.numero, vaga.entrada);
          }
        });
        
        mostrarResultado('resultadoVagas', `Total de vagas: ${vagas.length}`, 'info');
      } else {
        mostrarResultado('resultadoVagas', resultado.dados.mensagem, 'erro');
      }
    }

    // Fun√ß√£o para verificar tempo excedido
    async function verificarTempoExcedido() {
      document.getElementById('loadingTempo').classList.remove('hidden');
      document.getElementById('resultadoTempo').classList.add('hidden');
      
      const resultado = await fazerRequisicao('/tempo-excedido');
      
      document.getElementById('loadingTempo').classList.add('hidden');
      
      if (resultado.sucesso) {
        mostrarResultado('resultadoTempo', resultado.dados.mensagem, 'info');
      } else {
        mostrarResultado('resultadoTempo', resultado.dados.mensagem, 'erro');
      }
    }

    // Inicializar a primeira se√ß√£o
    document.addEventListener('DOMContentLoaded', function() {
      try {
        console.log('DOM carregado, inicializando...');
        
        // Por padr√£o, mostrar a se√ß√£o do supervisor
        abrirSecao('supervisor');
        
        console.log('Inicializa√ß√£o conclu√≠da');
      } catch (error) {
        console.error('Erro na inicializa√ß√£o:', error);
      }
    });

    // Limpar timers quando a p√°gina for fechada
    window.addEventListener('beforeunload', function() {
      pararTodosTimers();
    });

    // Limpar timers quando navegar para outra p√°gina
    window.addEventListener('unload', function() {
      pararTodosTimers();
    });

    // Fun√ß√£o para atualizar vagas automaticamente a cada 30 segundos quando na se√ß√£o de vagas
    let autoUpdateInterval;
    
    function iniciarAtualizacaoAutomatica() {
      autoUpdateInterval = setInterval(() => {
        const vagasSection = document.getElementById('vagas');
        if (vagasSection && !vagasSection.classList.contains('hidden')) {
          carregarVagas();
        }
      }, 30000); // 30 segundos
    }

    function pararAtualizacaoAutomatica() {
      if (autoUpdateInterval) {
        clearInterval(autoUpdateInterval);
        autoUpdateInterval = null;
      }
    }

    // Iniciar atualiza√ß√£o autom√°tica quando a p√°gina carregar
    document.addEventListener('DOMContentLoaded', function() {
      iniciarAtualizacaoAutomatica();
    });

    // Parar atualiza√ß√£o autom√°tica quando a p√°gina for fechada
    window.addEventListener('beforeunload', function() {
      pararAtualizacaoAutomatica();
    });
  </script>
  
  <!-- Carregar script.js para funcionalidades adicionais -->
  <script src="/static/script.js"></script>
</body>
</html> 